<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Family Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg1:#020617; --bg2:#020617; --bg3:#0f172a; --card:rgba(255,255,255,0.05); --border:rgba(255,255,255,0.1); --text:#fff; --muted:rgba(255,255,255,0.7); --accent:#fff; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(to bottom,var(--bg1),var(--bg2),var(--bg3));color:var(--text);min-height:100vh}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:32px 16px 48px}
    header{display:flex;flex-wrap:wrap;gap:16px;justify-content:space-between;align-items:flex-end;margin-bottom:32px}
    .kicker{font-size:11px;letter-spacing:.2em;text-transform:uppercase;opacity:.6}
    h1{margin:6px 0 0;font-size:28px;font-weight:600}
    .subtitle{margin-top:6px;max-width:680px;font-size:14px;color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:10px 16px;border-radius:14px;font-size:14px;font-weight:800;border:1px solid var(--border);background:transparent;color:var(--text);display:inline-flex;align-items:center;justify-content:center}
    .btn.primary{background:var(--accent);color:#020617;border:none}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;backdrop-filter:blur(6px)}
    .card h2{margin:0 0 12px;font-size:13px;letter-spacing:.04em;text-transform:uppercase;opacity:.9}
    .temp{font-size:48px;font-weight:650;line-height:1}
    .muted{color:var(--muted);font-size:13px}
    .forecast-row{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-radius:12px;background:rgba(255,255,255,0.04);margin-bottom:6px;font-size:13px}
    .fab5{display:grid;gap:8px}
    @media(min-width:700px){.fab5{grid-template-columns:repeat(5,1fr)}}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,0.04);font-size:12px;color:rgba(255,255,255,0.85)}
    .danger{border-color:rgba(239,68,68,0.25);background:rgba(239,68,68,0.14)}
    footer{margin-top:48px;font-size:12px;opacity:.45}
    button.city{all:unset;cursor:pointer}
    button.city:focus{outline:2px solid rgba(255,255,255,0.35);outline-offset:2px;border-radius:12px}
  </style>
</head>

<body>
  <main class="container">
    <header>
      <div>
        <div class="kicker">Family Weather</div>
        <h1>Weather that helps you plan real life.</h1>
        <p class="subtitle">
          Glance, plan, invite. Forecasts plus historical context, built for families and groups.
        </p>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
          <span class="pill">Location: <span id="locName">Northern California</span></span>
          <span class="pill">Updated: <span id="updatedAt">—</span></span>
          <span id="statusPill" class="pill" style="display:none"></span>
        </div>
      </div>

      <div class="actions">
        <a class="btn primary" href="dashboard.html">Plan an event</a>
        <a class="btn" href="events.html">Events</a>
        <a class="btn" href="about.html">About</a>
        <a class="btn" href="contact.html">Contact</a>
      </div>
    </header>

    <section class="grid cols-3">
      <div class="card">
        <h2>Right now</h2>
        <div class="muted" id="nowPlace">Loading…</div>
        <div class="temp"><span id="nowTemp">—</span>°</div>
        <div class="muted"><span id="nowCond">—</span> · Feels like <span id="nowFeels">—</span>°</div>
        <div class="muted">Wind <span id="nowWind">—</span> mph · Humidity <span id="nowHum">—</span>%</div>
      </div>

      <div class="card">
        <h2>10-day forecast</h2>
        <div id="forecastList">
          <div class="forecast-row"><span>Loading…</span><span>—</span></div>
          <div class="forecast-row"><span>Loading…</span><span>—</span></div>
          <div class="forecast-row"><span>Loading…</span><span>—</span></div>
          <div class="forecast-row"><span>Loading…</span><span>—</span></div>
          <div class="forecast-row"><span>Loading…</span><span>—</span></div>
        </div>
        <div class="muted" id="forecastNote" style="margin-top:8px">(Live via Open-Meteo. Paid provider swap later.)</div>
      </div>

      <div class="card">
        <h2>Alerts</h2>
        <div class="muted" id="alertsBox">No alerts right now.</div>
        <div class="muted" style="margin-top:8px; opacity:.7">(MVP) Alerts will be wired after we pick the paid API.</div>
      </div>
    </section>

    <section style="margin-top:16px" class="card">
      <h2>Fab 5 cities</h2>
      <div class="fab5" id="fab5">
        <!-- clickable tiles -->
      </div>
      <div class="muted" style="margin-top:10px">
        Tip: click a city to update “Right now” + forecast.
      </div>
    </section>

    <footer>
      © <span id="year"></span> Family Weather · Built for planning, not doomscrolling.
    </footer>
  </main>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const WMO = {
      0:"Clear", 1:"Mainly clear", 2:"Partly cloudy", 3:"Overcast",
      45:"Fog", 48:"Depositing rime fog",
      51:"Light drizzle", 53:"Drizzle", 55:"Dense drizzle",
      56:"Freezing drizzle", 57:"Freezing drizzle",
      61:"Slight rain", 63:"Rain", 65:"Heavy rain",
      66:"Freezing rain", 67:"Freezing rain",
      71:"Slight snow", 73:"Snow", 75:"Heavy snow", 77:"Snow grains",
      80:"Rain showers", 81:"Rain showers", 82:"Violent showers",
      85:"Snow showers", 86:"Snow showers",
      95:"Thunderstorm", 96:"Thunderstorm + hail", 99:"Thunderstorm + hail"
    };

    const fab5 = [
      { name:"Sacramento, CA", lat:38.5816, lon:-121.4944 },
      { name:"San Francisco, CA", lat:37.7749, lon:-122.4194 },
      { name:"Oakland, CA", lat:37.8044, lon:-122.2712 },
      { name:"Reno, NV", lat:39.5296, lon:-119.8138 },
      { name:"Los Angeles, CA", lat:34.0522, lon:-118.2437 },
    ];

    const els = {
      locName: document.getElementById("locName"),
      updatedAt: document.getElementById("updatedAt"),
      statusPill: document.getElementById("statusPill"),
      nowPlace: document.getElementById("nowPlace"),
      nowTemp: document.getElementById("nowTemp"),
      nowFeels: document.getElementById("nowFeels"),
      nowCond: document.getElementById("nowCond"),
      nowWind: document.getElementById("nowWind"),
      nowHum: document.getElementById("nowHum"),
      forecastList: document.getElementById("forecastList"),
      fab5: document.getElementById("fab5"),
    };

    function setStatus(msg, tone) {
      els.statusPill.style.display = "inline-flex";
      els.statusPill.className = "pill" + (tone === "danger" ? " danger" : "");
      els.statusPill.textContent = msg;
    }

    function clearStatus() {
      els.statusPill.style.display = "none";
      els.statusPill.textContent = "";
    }

    function fmtDay(iso) {
      const d = new Date(iso + "T00:00:00");
      return d.toLocaleDateString(undefined, { weekday:"short", month:"short", day:"numeric" });
    }

    async function loadWeather(place) {
      try {
        clearStatus();
        els.locName.textContent = place.name;
        els.nowPlace.textContent = place.name;

        setStatus("Loading live weather…");

        const url = new URL("https://api.open-meteo.com/v1/forecast");
        url.searchParams.set("latitude", place.lat);
        url.searchParams.set("longitude", place.lon);
        url.searchParams.set("timezone", "auto");
        url.searchParams.set("temperature_unit", "fahrenheit");
        url.searchParams.set("wind_speed_unit", "mph");
        url.searchParams.set("current", "temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,weather_code");
        url.searchParams.set("daily", "temperature_2m_max,temperature_2m_min,precipitation_probability_max,weather_code");
        url.searchParams.set("forecast_days", "10");

        const res = await fetch(url.toString(), { cache: "no-store" });
        if (!res.ok) throw new Error("Weather fetch failed");
        const data = await res.json();

        const c = data.current;
        els.nowTemp.textContent = Math.round(c.temperature_2m);
        els.nowFeels.textContent = Math.round(c.apparent_temperature);
        els.nowWind.textContent = Math.round(c.wind_speed_10m);
        els.nowHum.textContent = Math.round(c.relative_humidity_2m);
        els.nowCond.textContent = WMO[c.weather_code] || "Unknown";
        els.updatedAt.textContent = new Date(data.current.time).toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" });

        const t = data.daily.time;
        const hi = data.daily.temperature_2m_max;
        const lo = data.daily.temperature_2m_min;
        const pop = data.daily.precipitation_probability_max;
        const code = data.daily.weather_code;

        els.forecastList.innerHTML = "";
        for (let i = 0; i < Math.min(5, t.length); i++) {
          const row = document.createElement("div");
          row.className = "forecast-row";
          row.innerHTML = `
            <span>${fmtDay(t[i])} • <span style="opacity:.75">${WMO[code[i]] || "—"}</span></span>
            <span><span style="opacity:.75">${Math.round(lo[i])}°</span> / <strong>${Math.round(hi[i])}°</strong> <span style="opacity:.75">${pop[i] ?? 0}%</span></span>
          `;
          els.forecastList.appendChild(row);
        }

        setStatus("Live weather ✅");
        setTimeout(clearStatus, 1200);
      } catch (e) {
        setStatus("Weather unavailable (retry later)", "danger");
        els.nowPlace.textContent = place.name;
        els.nowTemp.textContent = "—";
        els.nowFeels.textContent = "—";
        els.nowWind.textContent = "—";
        els.nowHum.textContent = "—";
        els.nowCond.textContent = "—";
        els.updatedAt.textContent = "—";
        els.forecastList.innerHTML = `<div class="forecast-row"><span>Could not load forecast</span><span>—</span></div>`;
      }
    }

    // Render Fab 5 tiles
    els.fab5.innerHTML = "";
    fab5.forEach((c) => {
      const tile = document.createElement("div");
      tile.className = "forecast-row";
      const btn = document.createElement("button");
      btn.className = "city";
      btn.type = "button";
      btn.textContent = c.name;
      btn.addEventListener("click", () => loadWeather(c));
      tile.appendChild(btn);
      els.fab5.appendChild(tile);
    });

    // Default load
    loadWeather(fab5[0]);
  </script>
</body>
</html>
